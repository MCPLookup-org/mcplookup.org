(()=>{var e={};e.id=237,e.ids=[237],e.modules={124:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>h,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>l,OPTIONS:()=>u});var n=r(6559),o=r(8088),a=r(7719),i=r(2190),c=r(7116);async function l(e,{params:t}){try{let{domain:r}=await t,{searchParams:s}=new URL(e.url),n="true"===s.get("realtime");if(!r)return i.NextResponse.json({error:"Domain is required"},{status:400});let{registry:o,health:a}=(0,c.getServerlessServices)(),l=await o.getServersByDomain(r);if(0===l.length)return i.NextResponse.json({error:"Server not found",domain:r},{status:404});let u=l[0],h=u.health;if(n)try{h=await a.checkServerHealth(u.endpoint)}catch(e){console.warn(`Real-time health check failed for ${r}:`,e)}let m=await p(u.endpoint),w=await d(u.endpoint),v={domain:u.domain,endpoint:u.endpoint,health:h,capabilities_working:m,ssl_valid:w,trust_score:function(e,t,r,s){let n=0;switch(s&&(n+=40),e.status){case"healthy":n+=30;break;case"degraded":n+=15;break;case"down":n+=0;break;default:n+=10}return n+=Math.min(.2*e.uptime_percentage,20),r&&(n+=5),t&&(n+=5),Math.min(Math.round(n),100)}(h,m,w,u.verification.dns_verified)};return i.NextResponse.json(v,{headers:{"Cache-Control":n?"no-cache":"public, s-maxage=60","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}catch(e){return console.error("Health API error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}async function p(e){try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:"capability-check",method:"tools/list",params:{}})});if(!t.ok)return!1;let r=await t.json();return"2.0"===r.jsonrpc&&r.result&&Array.isArray(r.result.tools)}catch{return!1}}async function d(e){try{let t=new URL(e);if("https:"!==t.protocol)return!1;return(await fetch(e,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).status<500}catch{return!1}}let h=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/v1/health/[domain]/route",pathname:"/api/v1/health/[domain]",filename:"route",bundlePath:"app/api/v1/health/[domain]/route"},resolvedPagePath:"/mnt/persist/workspace/src/app/api/v1/health/[domain]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:w,serverHooks:v}=h;function x(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:w})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},5672:e=>{"use strict";e.exports=require("dns/promises")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[922,116],()=>r(124));module.exports=s})();