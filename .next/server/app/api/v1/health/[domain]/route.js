(()=>{var e={};e.id=237,e.ids=[237],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},35672:e=>{"use strict";e.exports=require("dns/promises")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},57493:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>h,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>l,OPTIONS:()=>u});var o=r(96559),n=r(48088),a=r(37719),i=r(32190),c=r(57116);async function l(e,{params:t}){try{let{domain:r}=await t,{searchParams:s}=new URL(e.url),o="true"===s.get("realtime");if(!r)return i.NextResponse.json({error:"Domain is required"},{status:400});let{registry:n,health:a}=(0,c.getServerlessServices)(),l=await n.getServersByDomain(r);if(0===l.length)return i.NextResponse.json({error:"Server not found",domain:r},{status:404});let u=l[0],h=u.health;if(o)try{h=await a.checkServerHealth(u.endpoint)}catch(e){console.warn(`Real-time health check failed for ${r}:`,e)}let m=await p(u.endpoint),w=await d(u.endpoint),v={domain:u.domain,endpoint:u.endpoint,health:h,capabilities_working:m,ssl_valid:w,trust_score:function(e,t,r,s){let o=0;switch(s&&(o+=40),e.status){case"healthy":o+=30;break;case"degraded":o+=15;break;case"down":o+=0;break;default:o+=10}return o+=Math.min(.2*e.uptime_percentage,20),r&&(o+=5),t&&(o+=5),Math.min(Math.round(o),100)}(h,m,w,u.verification.dns_verified)};return i.NextResponse.json(v,{headers:{"Cache-Control":o?"no-cache":"public, s-maxage=60","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}catch(e){return console.error("Health API error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}async function p(e){try{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:"capability-check",method:"tools/list",params:{}})});if(!t.ok)return!1;let r=await t.json();return"2.0"===r.jsonrpc&&r.result&&Array.isArray(r.result.tools)}catch{return!1}}async function d(e){try{let t=new URL(e);if("https:"!==t.protocol)return!1;return(await fetch(e,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).status<500}catch{return!1}}let h=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/health/[domain]/route",pathname:"/api/v1/health/[domain]",filename:"route",bundlePath:"app/api/v1/health/[domain]/route"},resolvedPagePath:"C:\\Users\\T\\Projects\\mcplookup.org\\src\\app\\api\\v1\\health\\[domain]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:w,serverHooks:v}=h;function x(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:w})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580,116],()=>r(57493));module.exports=s})();